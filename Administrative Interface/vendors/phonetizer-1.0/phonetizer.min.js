function phonetizer(e){e=(e=e.toUpperCase().trim()).replace(/( |^)(DEL|DA|DE|DI|DO|DU|DAS|DOS|DEU|DER|E|LA|LE|LES|LOS|VAN|VON|EL)( |$)/i," ");for(var a=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],o=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],i=0;i<a.length;i++)e=e.replace(a[i],o[i]);e=e.replace(/[^A-Za-z0-9&_ ]/,""),last=" ",c="";for(i=0;i<e.length;i++)(e[i]!=last||" "==e[i]||e[i]>=0&&e[i]<=9||"S"==e[i]&&"S"==e[i-1]&&i>1&&"S"!=e[i-2])&&(c+=e[i]),last=e[i];words=c.split(/ /);for(var r=0;r<words.length;r++){word=words[r]+" ";var c=[],s=[],f=[],b=0;if(1==word.length)switch(word[0]){case"_":c[0]=" ";break;case"E":case"&":case"I":c[0]="i";break;default:c[0]=word[0]}else{for(i=0;i<word.length;i++)switch(word[i]){case"_":s[i]="Y";break;case"&":case"E":case"Y":case"I":s[i]="i";break;case"O":case"U":s[i]="o";break;case"A":s[i]="a";break;case"S":s[i]="s";break;default:s[i]=word[i]}if(endfon=0,3==(f=s).length&&("a"==f[0]||"i"==f[0]||"o"==f[0]?endfon=0:"a"==f[1]||"i"==f[1]||"o"==f[1]?endfon=0:"a"==f[2]||"i"==f[2]||"o"==f[2]?endfon=0:(endfon=1,c[0]=f[0],c[1]=f[1],c[2]=f[2])),1!=endfon)for(i=0;i<f.length-1;i++){switch(copfon=0,copmud=0,newmud=0,f[i]){case"a":"s"==f[i+1]||"Z"==f[i+1]||"M"==f[i+1]||"N"==f[i+1]?" "!=f[i+2]?copfon=1:(c[b]="a",c[b+1]=" ",b++,i++):copfon=1;break;case"B":copmud=1;break;case"C":if("i"==f[i+1]){c[b]="s",b++;break}if("o"==f[i+1]&&"i"==f[i+2]&&"s"==f[i+3]&&" "==f[i+4]){c[b]="K",c[b+1]="a",c[b+2]="o",i+=4;break}if("T"==f[i+1])break;if("H"!=f[i+1]){c[b]="K",newmud=1,"K"==f[i+1]&&i++;break}if(x=0,"H"==f[i+1]&&"i"==f[i+2]&&("a"==f[i+3]||"i"==f[i+3]||"o"==f[i+3]?x=1:"N"!=f[i+3]&&"T"!=f[i+3]||"i"!=f[i+4]||" "!=f[i+5]||(x=1)),1==x){c[b]="K",b++,i++;break}b>0&&"s"==c[b-1]&&b--,c[b]="X",newmud=1,i++;break;case"D":if(x=0,"o"!=f[i+1]){copmud=1;break}"R"==f[i+2]&&0!=i?x=1:copfon=1,1==x?"i"==f[i+3]?"s"==f[i+4]?" "!=f[i+5]&&(x=0):x=0:"a"==f[i+3]?" "!=f[i+4]&&("s"!=f[i+4]?x=0:" "!=f[i+5]&&(x=0)):x=0:x=0,1==x?(c[b]="D",c[b+1]="o",c[b+2]="R",i+=5):copfon=1;break;case"F":copmud=1;break;case"G":"o"==f[i+1]?"i"==f[i+2]?(c[b]="G",c[b+1]="i",b+=2,i+=2):copmud=1:"L"==f[i+1]?"i"==f[i+2]?"a"==f[i+3]||"i"==f[i+3]||"o"==f[i+3]?(c[b]=f[i+1],c[b+1]=f[i+2],b+=2,i+=2):"N"==f[i+3]?(c[b]=f[i+1],c[b+1]=f[i+2],b+=2,i+=2):copmud=1:copmud=1:"N"==f[i+1]?"a"!=f[i+2]&&"i"!=f[i+2]&&"o"!=f[i+2]?copmud=1:(c[b]="N",c[b+1]="i",b+=2,i++):"H"==f[i+1]&&"i"==f[i+2]?(c[b]="G",c[b+1]="i",b+=2,i+=2):copmud=1;break;case"H":break;case"i":if(" "==f[i+2]&&("s"==f[i+1]||"Z"==f[i+1])){c[b]="i";break}if("X"!=f[i+1])copfon=1;else{if(0==i){if("a"==f[i+2]||"i"==f[i+2]||"o"==f[i+2]){c[b]="i",c[b+1]="Z",b+=2,i++;break}"C"==f[i+2]||"s"==f[i+2]?(c[b]="i",b++,i++):(c[b]="i",c[b+1]="s",b+=2,i++);break}copfon=1}break;case"J":c[b]="G",c[b+1]="i",b+=2;break;case"K":"T"!=f[i+1]&&(copmud=1);break;case"L":if("a"==f[i+1]||"i"==f[i+1]||"o"==f[i+1])copfon=1;else{if("H"!=f[i+1]){c[b]="o",b++;break}if("a"==f[i+2]||"i"==f[i+2]||"o"==f[i+2]){c[b]="L",c[b+1]="i",b+=2,i++;break}copfon=1}break;case"M":"a"!=f[i+1]&&"i"!=f[i+1]&&"o"!=f[i+1]||" "==f[i+1]?(c[b]="N",b++):copfon=1;break;case"N":"G"==f[i+1]&&"T"==f[i+2]?(f[i+1]="N",copfon=1):"H"==f[i+1]?"a"!=f[i+2]&&"i"!=f[i+2]&&"o"!=f[i+2]?copfon=1:(c[b]="N",c[b+1]="i",b+=2,i++):copfon=1;break;case"o":"s"!=f[i+1]&&"Z"!=f[i+1]||" "!=f[i+2]?copfon=1:c[b]="o";break;case"P":"H"==f[i+1]?(c[b]="F",i++,newmud=1):copmud=1;break;case"Q":if("o"==f[i+1]&&"i"==f[i+2]){c[b]="K",b++,i++;break}c[b]="K",b++;break;case"R":copfon=1;break;case"s":if(" "==f[i+1])break;if("a"==f[i+1]||"i"==f[i+1]||"o"==f[i+1]){if(0==i){copfon=1;break}if("a"!=f[i-1]&&"i"!=f[i-1]&&"o"!=f[i-1]){copfon=1;break}"o"==f[i+1]&&"L"==f[i+2]&&" "==f[i+3]?copfon=1:(c[b]="Z",b++);break}if("s"==f[i+1]){" "!=f[i+2]?(copfon=1,i++):f[i+1]=" ";break}if(0==i&&!("C"==f[i+1]&&"i"==f[i+2]||"H"==f[i+1]||"C"==f[i+1]&&"H"==f[i+2]&&"a"!=f[i+3]&&"i"!=f[i+3]&&"o"!=f[i+3])){c[b]="i",b++,copfon=1;break}if("H"==f[i+1]){c[b]="X",i++,newmud=1;break}if("C"!=f[i+1]){copfon=1;break}if("H"==f[i+2]){c[b]="X",i+=2,newmud=1;break}if("i"!=f[i+2]){copfon=1;break}if(" "==f[i+3]){c[b]="X",c[b+1]="i",i+=3;break}if(" "==f[i+3]){c[b]="X",c[b+1]="i",i+=3;break}if("a"==f[i+3]||"i"==f[i+3]||"o"==f[i+3]){c[b]="X",b++,i+=2;break}c[b]="s",c[b+1]="i",b+=2,i+=2;break;case"T":if("s"==f[i+1]||"Z"==f[i+1])break;copmud=1;break;case"V":case"W":("a"==f[i+1]||"i"==f[i+1]||"o"==f[i+1])&&0==i?(c[b]="o",b++):(c[b]="V",newmud=1);break;case"X":copmud=1;break;case"Y":break;case"Z":if(" "==f[i+1])break;"a"==f[i+1]||"i"==f[i+1]||"o"==f[i+1]?copfon=1:(c[b]="s",b++);break;default:c[b]=f[i],b++}if(1==copfon&&(c[b]=f[i],b++),1==copmud&&(c[b]=f[i]),1==copmud||1==newmud)for(b++,k=0;0==k;)" "==f[i+1]?(c[b]="i",k=1):"a"==f[i+1]||"i"==f[i+1]||"o"==f[i+1]?k=1:"X"==c[b-1]?(c[b]="i",b++,k=1):"R"==f[i+1]||"L"==f[i+1]?k=1:"H"!=f[i+1]?(c[b]="i",b++,k=1):i++}}for(i=0;i<c.length;i++)switch(c[i]){case"i":c[i]="I";break;case"a":c[i]="A";break;case"o":c[i]="U";break;case"s":c[i]="S";break;case"E":c[i]=" ";break;case"Y":c[i]="_"}words[r]=c.join(""),b=0}e=words.join(" "),last=" ",c="";for(i=0;i<e.length;i++)(e[i]!=last||" "==e[i]||e[i]>="0"&&e[i]<="9"||"S"==e[i]&&"S"==e[i-1]&&i>1&&"S"!=e[i-2])&&(c+=e[i]),last=e[i];return c.toUpperCase().trim()}
