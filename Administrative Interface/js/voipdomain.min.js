var VoIP=(function()
{var modules={};var paths={};var lastpath={};var events={'session_timeout':function(data)
{location.reload();return false;}};var apiurl='/api';var title='VoIP Domain';var user='';var name='';var uid='';this.about={version:'1.0',author:'Ernani José Camargo Azevedo'};this.parameters=null;this.settings=function(variables)
{if('title'in variables)
{title=variables.title;}
if('user'in variables)
{user=variables.user;}
if('name'in variables)
{name=variables.name;}
if('uid'in variables)
{uid=variables.uid;}};this.getUID=function()
{return uid;}
this.getUser=function()
{return user;}
this.getName=function()
{return name;}
var module={add:function(module,data)
{modules[module]=data;},del:function(module)
{delete modules[module];},getAll:function()
{return modules;},fire:function(module,parameters)
{if(typeof($.fn.stickyTableHeaders)=='function')
{$('table').each(function()
{$(this).stickyTableHeaders('destroy');});}
$('div.tooltip[id^="tooltip"]').remove();if(typeof($.fn.select2)=='function')
{$('select.select2-hidden-accessible').select2('close');}
$('.modal').modal('hide');if(typeof($.fn.dataTable)=='function')
{$('table:not([data-dt=""]').each(function()
{try
{$(this).data('dt').destroy(true);}catch(e){}});}
if(typeof($.ladda)=='function')
{$.ladda('stopAll');}
$('section.content-header').fadeOut('fast',function()
{$('#page_title').html(modules[module].title);$('#page_subtitle').html(('subtitle'in modules[module]?' - '+modules[module].subtitle:''));var breadcrumb='<li'+(modules[module].breadcrumb.length==0?' class="active"':'><a href="/"')+'><i class="fa fa-dashboard"></i> Início'+(modules[module].breadcrumb.length==0?'':'</a>')+'</li>';for(var x in modules[module].breadcrumb)
{if('link'in modules[module].breadcrumb[x])
{breadcrumb+='<li><a href="'+modules[module].breadcrumb[x].link+'">'+modules[module].breadcrumb[x].title+'</a></li>';}else{breadcrumb+='<li class="active">'+modules[module].breadcrumb[x].title+'</li>';}}
$('#page_breadcrumb').html(breadcrumb);}).fadeIn('fast');$('#content').html(modules[module].content);VoIP.parameters=parameters;if('inlinejs'in modules[module])
{$('<script type="text/javascript">').text(modules[module].inlinejs).appendTo('body');}
setTimeout(function(){$('#content [data-toggle="tooltip"]').tooltip();},0);if(location.hash&&$('.nav-tabs a[href="'+location.hash+'"]').length!=0)
{$('.nav-tabs a[href="'+location.hash+'"]').tab('show');}
console.log('Firing module '+module+' with parameters: '+JSON.stringify(parameters));},load:function(path,callonload,pushonload)
{callonload=(typeof(callonload)==='undefined'?false:callonload);pushonload=(typeof(pushonload)==='undefined'?true:pushonload);if(path=='/')
{path='/dashboard';}
$('.wrapper').animate({scrollTop:0},100);$('.percentage').css('width',0).css('display','block').animate({width:'10%'},50);$.ajax({url:(path.indexOf('#')!=-1?path.substring(0,path.indexOf('#')):path),headers:{'X-INFramework':'page'},async:true,cache:false,error:function(jqXHR,textStatus,errorThrown)
{console.log('Error loading page: '+jqXHR.status+' '+jqXHR.statusText);console.log('Received data: '+jqXHR.responseText);},success:function(data,textStatus,jqXHR)
{if(typeof(data)=='object'&&'event'in data)
{if(data.event=='session_timeout')
{if(location.pathname==(VoIP.lastpath.indexOf('#')!=-1?VoIP.lastpath.substring(0,VoIP.lastpath.indexOf('#')):VoIP.lastpath))
{location.reload();}else{location.href=VoIP.lastpath;}}else{event.call(data);}
return;}
if(typeof(data)!='object'||!('index'in data))
{console.log('Error loading page. Returned data: '+JSON.stringify(data));return;}
paths[data.index]=data.hook;modules[data.hook]=data;if('inlinecss'in data)
{$('<style type="text/css">').text(data.inlinecss).appendTo('head');}
$.loader({js:data.js,css:data.css,onrefresh:function(loaded,total,percentage)
{$('.percentage').animate({width:percentage+'%'},50);},onfinish:function()
{$('.percentage').fadeOut('slow');if(callonload)
{VoIP.path.call(path,pushonload);}}});}});}};this.event={add:function(event,code)
{events[event]=code;},del:function(event)
{delete events[event];},call:function(data)
{if(typeof(data)=='object'&&'event'in data&&typeof(events[data.event])=='function')
{events[data.event](data);}else{return false;}}};this.path={add:function(index,module)
{paths[index]=module;},del:function(index)
{delete paths[index];},getAll:function()
{return paths;},call:function(path,push)
{push=(typeof(push)==='undefined'?true:push);searchpath=(path.indexOf('#')!=-1?path.substring(0,path.indexOf('#')):path);if(path=='/logout')
{VoIP.rest('/sys/session','DELETE');location.href='/';return;}
VoIP.lastpath=path;for(var key in paths)
{var match=matchPath(key,searchpath);if(match!==false)
{if(push)
{history.pushState(null,null,path);}
module.fire(paths[key],match);return;}}
module.load(path,true,push);}};this.dataTables=function(path,route,data)
{var data=rest(path,route,data);if(typeof(data.result)=='object'&&data.API.status=='ok')
{return data.result;}else{console.log('VoIP API dataTables wrapper request error. Status: '+data.API.statusCode+' '+data.API.statusText);return[];}}
this.select2=function(path,route,data)
{var data=rest(path,route,data);if(typeof(data.result)=='object'&&data.API.status=='ok')
{var ret=[];for(var x in data.result)
{ret.push({id:data.result[x][0],text:data.result[x][1]});}
return ret;}else{console.log('VoIP API select2 wrapper request error. Status: '+data.API.statusCode+' '+data.API.statusText);return[];}}
this.rest=function(path,route,data)
{if(path.substring(0,1)!='/')
{path='/'+path;}
var result=null;$.ajax({type:'POST',url:apiurl+path,data:JSON.stringify(data),async:false,cache:false,headers:{'X-INFramework':'api','X-HTTP-Method-Override':route,'Accept':'application/json'},contentType:'application/json; charset=utf-8',dataType:'json',success:function(data,textStatus,jqXHR)
{result={result:data,API:{status:'ok',content:jqXHR.responseText,statusCode:jqXHR.statusCode().status,statusText:jqXHR.statusCode().statusText,headers:jqXHR.getAllResponseHeaders()}};},error:function(jqXHR,textStatus,errorThrown)
{try
{var jsonresult=JSON.parse(jqXHR.responseText);}catch(e){var jsonresult=[];}
if('event'in jsonresult)
{if(jsonresult.event=='session_timeout')
{if(location.pathname==(VoIP.lastpath.indexOf('#')!=-1?VoIP.lastpath.substring(0,VoIP.lastpath.indexOf('#')):VoIP.lastpath))
{location.reload();}else{location.href=VoIP.lastpath;}}else{event.call(jsonresult.event);}}
result={result:jsonresult,API:{status:'error',content:jqXHR.responseText,statusCode:jqXHR.statusCode().status,statusText:jqXHR.statusCode().statusText,headers:jqXHR.getAllResponseHeaders()}};}});return result;}
this.matchPath=function(match,needle)
{matches={};while(match!='')
{search=match.substring(0,1);match=match.substring(1);if(search==':')
{key='';value='';if(needle.indexOf('/')==-1)
{value=needle;needle='';}else{value=needle.substring(0,needle.indexOf('/'));needle=needle.substring(needle.indexOf('/')+1);}
if(match.indexOf('/')==-1)
{key=match;match='';}else{key=match.substring(0,match.indexOf('/'));match=match.substring(match.indexOf('/')+1);}
matches[key]=value;}else{if(search!=needle.substring(0,1))
{return false;}
needle=needle.substring(1);}}
if(needle.length!=0)
{return false;}
return matches;}
return this;})();function format_secs_to_string(time)
{result='';if(time>=86400)
{if(Math.floor(time/86400)<10)
{result+='0';}
result+=Math.floor(time/86400)+':';time=time%86400;if(Math.floor(time/3600)<10)
{result+='0';}
result+=Math.floor(time/3600)+':';time=time%3600;}else{if(time>=3600)
{if(Math.floor(time/3600)<10)
{result+='0';}
result+=Math.floor(time/3600)+':';time=time%3600;}}
if(Math.floor(time/60)<10)
{result+='0';}
result+=Math.floor(time/60)+':';time=time%60;if(time<10)
{result+='0';}
result+=time;return result;}
(function($)
{$.fn.alerts=function(action,options)
{var opts=$.extend({},$.fn.alerts.defaults,options);return this.each(function()
{var that=this;switch(action)
{case 'add':if(typeof($(that).data('select2'))==='object')
{$(that).data('popover',$(that).next('span.select2-container').popover({placement:opts.placement,content:opts.message,trigger:opts.trigger}).popover('show'));$(that).parent().find('span.select2-selection').addClass(opts.class);}else{$(that).data('popover',$(that).popover({placement:opts.placement,content:opts.message,trigger:opts.trigger}).popover('show'));$(that).addClass(opts.class);}
setTimeout(function(){if($(that).data('popover')!=undefined){$(that).data('popover').popover('destroy');$(that).removeData('popover');}},opts.timeout);break;case 'clear':if($(that).data('popover')!=undefined)
{$(that).data('popover').popover('destroy');$(that).removeData('popover');}
if(typeof($(that).data('select2'))==='object')
{$(that).parent().find('span.select2-selection').removeClass(opts.class);}else{$(that).removeClass(opts.class);}
break;case 'clearAll':case 'clearall':$(that).find('input,select,textarea').each(function(){$(this).alerts('clear',opts);});break;case 'check':var tabs=false;var tab='';if($(that).find('ul.nav-tabs').length!=0)
{tabs=true;}
for(var index in opts.errors)
{if(!opts.errors.hasOwnProperty(index)||index=='result')
{continue;}
if($(that).find('[name="'+index+'"]').length!=0)
{if(tabs&&tab=='')
{tab=$(that).find('[name="'+index+'"]').closest('div.tab-pane').attr('id');}
$(that).find('[name="'+index+'"]').alerts('add',$.extend({},opts,{message:opts.errors[index]}));}}
if(tabs&&tab!='')
{$(that).find('a[href="#'+tab+'"]').tab('show');}
break;case 'form':$(that).on('submit',function(event)
{event&&event.preventDefault();$(that).alerts('clearAll');if(typeof(opts.form.button)=='object')
{$(opts.form.button).attr('disabled','disabled');var l=Ladda.create($(opts.form.button)[0]);l.start();}
var data=VoIP.rest(opts.form.URL,opts.form.method,$(that).serializeObject());if(typeof(data.result)!='object')
{new PNotify({title:opts.form.title,text:opts.form.fail,type:'error'});if(typeof(opts.form.onfail)=='function')
{opts.form.onfail();}}else{if(data.result.result===true)
{new PNotify({title:opts.form.title,text:opts.form.success,type:'success'});if(typeof(opts.form.onsuccess)=='function')
{opts.form.onsuccess();}}else{$(that).alerts('check',{errors:data.result});}}
if(typeof(opts.form.button)=='object')
{l.stop();$(opts.form.button).removeAttr('disabled');}});break;}});};$.fn.alerts.defaults={message:'',placement:'auto top',trigger:'manual',timeout:5000,class:'alert-danger'};$.fn.serializeObject=function()
{var o={};var a=this.serializeArray();$.each(a,function()
{if(o[this.name])
{if(!o[this.name].push)
{o[this.name]=[o[this.name]];}
o[this.name].push(this.value||'');}else{o[this.name]=this.value||'';}});return o;};$.hashForm=function(action,options)
{switch(action)
{case 'check':if(location.hash!='')
{var data=JSON.parse('{"'+decodeURI(location.hash.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');var filled=false;for(var key in data)
{if($('#'+key).length>0)
{$('#'+key).val(decodeURIComponent(data[key]));if(typeof($.fn.select2)=='function'&&typeof($('#'+key).data('select2'))=='object')
{$('#'+key).trigger('change.select2');}
filled=true;}}
if(filled==true&&typeof options.onfill==='function')
{options.onfill(data);}}
if(typeof options.onfinish==='function')
{options.onfinish(data);}
break;case 'set':if(location.hash!=$(options.form).serialize())
{history.replaceState(null,null,(location.hash?location.href.substring(0,location.href.indexOf('#')):location.href)+'#'+$(options.form).serialize());}
break;}
return this;};}(jQuery));$(document).ready(function()
{$('#content').on('shown.bs.tab',function(event)
{$($(event.target).attr('href')).find('input,select,textarea').each(function()
{if(typeof($.fn.select2)=='function'&&typeof($(this).data('select2'))=='object')
{$(this).trigger('change.select2');}
if(typeof($.fn.slider)=='function'&&typeof($(this).data('slider'))=='object')
{$(this).slider('relayout');}});});var location=window.history.location||window.location;$(document).on('click','a',function(e)
{if(this.href.charAt(location.href.length)=='#'||$(this).attr('href')=='#'||$(this).attr('href')==''||this.href==location.href)
{e&&e.preventDefault();return false;}
var href=location.protocol+'//'+location.hostname;if(location.port!='')
{href+=':'+location.port;}
if(this.href.substring(0,href.length)!=href)
{return true;}
VoIP.path.call(this.href.substring(href.length),true);return false;});$(window).on('popstate',function(e)
{VoIP.path.call(location.href.replace(/^.*\/\/[^\/]+/,''),false);});});